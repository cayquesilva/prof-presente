# ü™ü Guia de Instala√ß√£o Local - Windows

## Sistema de Crach√°s Virtuais - Instala√ß√£o para Desenvolvimento Local

Este guia fornece instru√ß√µes detalhadas para configurar o Sistema de Crach√°s Virtuais em um ambiente de desenvolvimento local no Windows, utilizando PostgreSQL em cont√™iner Docker para facilitar a configura√ß√£o e manuten√ß√£o do banco de dados.

## üìã Pr√©-requisitos

### Software Necess√°rio

Antes de iniciar a instala√ß√£o, certifique-se de ter os seguintes softwares instalados em seu sistema Windows:

**Node.js (vers√£o 18.0 ou superior)**
O Node.js √© essencial para executar tanto o backend quanto o frontend da aplica√ß√£o. Recomendamos a vers√£o LTS mais recente para garantir estabilidade e suporte de longo prazo.

1. Acesse o site oficial do Node.js: https://nodejs.org/
2. Baixe a vers√£o LTS (Long Term Support) para Windows
3. Execute o instalador e siga as instru√ß√µes padr√£o
4. Marque a op√ß√£o "Automatically install the necessary tools" durante a instala√ß√£o
5. Ap√≥s a instala√ß√£o, abra o Prompt de Comando ou PowerShell e verifique:
   ```cmd
   node --version
   npm --version
   ```

**Git para Windows**
O Git √© necess√°rio para clonar o reposit√≥rio e gerenciar vers√µes do c√≥digo.

1. Acesse: https://git-scm.com/download/win
2. Baixe e execute o instalador
3. Durante a instala√ß√£o, mantenha as configura√ß√µes padr√£o
4. Certifique-se de que "Git Bash" seja instalado junto
5. Verifique a instala√ß√£o:
   ```cmd
   git --version
   ```

**Docker Desktop para Windows**
O Docker ser√° usado exclusivamente para executar o banco de dados PostgreSQL, simplificando a configura√ß√£o e evitando conflitos com outras instala√ß√µes.

1. Acesse: https://www.docker.com/products/docker-desktop/
2. Baixe o Docker Desktop para Windows
3. Execute o instalador como administrador
4. Ap√≥s a instala√ß√£o, reinicie o computador se solicitado
5. Inicie o Docker Desktop e aguarde a inicializa√ß√£o completa
6. Verifique a instala√ß√£o:
   ```cmd
   docker --version
   docker-compose --version
   ```

**Editor de C√≥digo (Recomendado)**
Embora n√£o seja obrigat√≥rio, recomendamos o uso de um editor de c√≥digo moderno:

- **Visual Studio Code**: https://code.visualstudio.com/
- **WebStorm**: https://www.jetbrains.com/webstorm/
- **Sublime Text**: https://www.sublimetext.com/

### Configura√ß√£o do Ambiente

**Configura√ß√£o do PowerShell (Recomendado)**
Para uma melhor experi√™ncia de desenvolvimento, configure o PowerShell como terminal padr√£o:

1. Abra o PowerShell como administrador
2. Execute o comando para permitir scripts:
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
3. Instale o Windows Terminal (opcional, mas recomendado):
   - Acesse a Microsoft Store
   - Procure por "Windows Terminal"
   - Instale e configure como terminal padr√£o

**Configura√ß√£o de Vari√°veis de Ambiente**
Certifique-se de que o Node.js e npm estejam no PATH do sistema:

1. Pressione `Win + R`, digite `sysdm.cpl` e pressione Enter
2. Clique na aba "Avan√ßado"
3. Clique em "Vari√°veis de Ambiente"
4. Verifique se existe uma entrada para Node.js no PATH do sistema
5. Se n√£o existir, adicione o caminho de instala√ß√£o do Node.js (geralmente `C:\Program Files\nodejs\`)

## üóÑÔ∏è Configura√ß√£o do Banco de Dados PostgreSQL

### Cria√ß√£o do Docker Compose para Desenvolvimento

O PostgreSQL ser√° executado em um cont√™iner Docker, proporcionando isolamento e facilidade de configura√ß√£o. Esta abordagem elimina a necessidade de instalar o PostgreSQL diretamente no Windows e evita conflitos com outras aplica√ß√µes.

Crie um arquivo chamado `docker-compose.dev.yml` na raiz do projeto com o seguinte conte√∫do:

```yaml
version: '3.8'

services:
  # Banco de dados PostgreSQL para desenvolvimento
  postgres-dev:
    image: postgres:15-alpine
    container_name: cracha_postgres_dev
    restart: unless-stopped
    environment:
      POSTGRES_DB: cracha_virtual_dev
      POSTGRES_USER: cracha_user
      POSTGRES_PASSWORD: cracha123
      POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
    ports:
      - "5432:5432"
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data
      - ./scripts/init-dev.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - cracha_dev_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U cracha_user -d cracha_virtual_dev"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Adminer para administra√ß√£o do banco (opcional)
  adminer:
    image: adminer:latest
    container_name: cracha_adminer_dev
    restart: unless-stopped
    ports:
      - "8080:8080"
    networks:
      - cracha_dev_network
    depends_on:
      - postgres-dev

volumes:
  postgres_dev_data:
    driver: local

networks:
  cracha_dev_network:
    driver: bridge
```

### Script de Inicializa√ß√£o do Banco

Crie um diret√≥rio `scripts` na raiz do projeto e dentro dele um arquivo `init-dev.sql`:

```sql
-- Script de inicializa√ß√£o para desenvolvimento
-- Configura√ß√µes otimizadas para ambiente local

-- Criar extens√µes necess√°rias
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_stat_statements";

-- Configura√ß√µes de performance para desenvolvimento
ALTER SYSTEM SET shared_buffers = '128MB';
ALTER SYSTEM SET effective_cache_size = '512MB';
ALTER SYSTEM SET maintenance_work_mem = '32MB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
ALTER SYSTEM SET wal_buffers = '8MB';
ALTER SYSTEM SET default_statistics_target = 100;
ALTER SYSTEM SET random_page_cost = 1.1;
ALTER SYSTEM SET effective_io_concurrency = 200;

-- Configura√ß√µes espec√≠ficas para desenvolvimento
ALTER SYSTEM SET log_statement = 'all';
ALTER SYSTEM SET log_duration = on;
ALTER SYSTEM SET log_min_duration_statement = 1000;

-- Recarregar configura√ß√µes
SELECT pg_reload_conf();

-- Criar usu√°rio adicional para desenvolvimento (opcional)
DO $$
BEGIN
    IF NOT EXISTS (SELECT FROM pg_catalog.pg_roles WHERE rolname = 'dev_user') THEN
        CREATE ROLE dev_user WITH LOGIN PASSWORD 'dev123';
        GRANT CONNECT ON DATABASE cracha_virtual_dev TO dev_user;
        GRANT USAGE ON SCHEMA public TO dev_user;
        GRANT CREATE ON SCHEMA public TO dev_user;
    END IF;
END
$$;
```

### Inicializa√ß√£o do Banco de Dados

Para inicializar o banco de dados PostgreSQL em Docker:

1. **Abra o PowerShell ou Prompt de Comando** na raiz do projeto
2. **Inicie o Docker Desktop** e aguarde at√© que esteja completamente carregado
3. **Execute o comando para iniciar o banco**:
   ```cmd
   docker-compose -f docker-compose.dev.yml up -d postgres-dev
   ```
4. **Verifique se o cont√™iner est√° rodando**:
   ```cmd
   docker ps
   ```
5. **Teste a conex√£o com o banco**:
   ```cmd
   docker exec -it cracha_postgres_dev psql -U cracha_user -d cracha_virtual_dev -c "SELECT version();"
   ```

### Administra√ß√£o do Banco (Opcional)

O Adminer foi inclu√≠do no docker-compose para facilitar a administra√ß√£o do banco de dados atrav√©s de uma interface web:

1. **Inicie o Adminer**:
   ```cmd
   docker-compose -f docker-compose.dev.yml up -d adminer
   ```
2. **Acesse no navegador**: http://localhost:8080
3. **Credenciais de acesso**:
   - Sistema: PostgreSQL
   - Servidor: postgres-dev
   - Usu√°rio: cracha_user
   - Senha: cracha123
   - Base de dados: cracha_virtual_dev

## üöÄ Instala√ß√£o do Projeto

### Download e Configura√ß√£o Inicial

**M√©todo 1: Download do ZIP**
1. Baixe o arquivo ZIP do projeto
2. Extraia para um diret√≥rio de sua escolha (ex: `C:\Projetos\cracha-virtual-system`)
3. Abra o PowerShell na pasta extra√≠da

**M√©todo 2: Clone via Git (se dispon√≠vel)**
```cmd
git clone [URL_DO_REPOSITORIO] cracha-virtual-system
cd cracha-virtual-system
```

### Configura√ß√£o do Backend

Navegue at√© o diret√≥rio do backend e configure o ambiente:

```cmd
cd cracha-virtual-system
```

**Instala√ß√£o das Depend√™ncias**
```cmd
npm install
```

Se encontrar erros de resolu√ß√£o de depend√™ncias, use:
```cmd
npm install --legacy-peer-deps
```

**Configura√ß√£o das Vari√°veis de Ambiente**
Crie um arquivo `.env` na raiz do diret√≥rio backend com o seguinte conte√∫do:

```env
# Configura√ß√µes do banco de dados
DATABASE_URL="postgresql://cracha_user:cracha123@localhost:5432/cracha_virtual_dev"

# Configura√ß√µes JWT
JWT_SECRET="sua_chave_secreta_super_segura_para_desenvolvimento"
JWT_EXPIRES_IN="24h"

# Configura√ß√µes do servidor
PORT=3000
NODE_ENV="development"

# Configura√ß√µes de upload
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE="5242880"

# Configura√ß√µes de CORS
CORS_ORIGIN="http://localhost:5173"

# Configura√ß√µes do pool de conex√µes
DB_POOL_MAX=10
DB_POOL_MIN=2
DB_POOL_ACQUIRE_TIMEOUT=60000
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_MAX_LIFETIME=1800000
```

**Configura√ß√£o do Prisma**
```cmd
# Gerar o cliente Prisma
npx prisma generate

# Executar migra√ß√µes
npx prisma migrate dev --name init

# Popular banco com dados de exemplo (opcional)
node scripts/seed.js
```

### Configura√ß√£o do Frontend

Abra um novo terminal PowerShell e navegue at√© o diret√≥rio do frontend:

```cmd
cd cracha-virtual-frontend
```

**Instala√ß√£o das Depend√™ncias**
```cmd
npm install
```

**Configura√ß√£o das Vari√°veis de Ambiente**
Crie um arquivo `.env` na raiz do diret√≥rio frontend:

```env
VITE_API_URL=http://localhost:3000/api
```

## ‚ñ∂Ô∏è Executando o Sistema

### Inicializa√ß√£o dos Servi√ßos

Para executar o sistema completo, voc√™ precisar√° de tr√™s terminais:

**Terminal 1 - Banco de Dados (se n√£o estiver rodando)**
```cmd
docker-compose -f docker-compose.dev.yml up -d
```

**Terminal 2 - Backend**
```cmd
cd cracha-virtual-system
npm run dev
```

**Terminal 3 - Frontend**
```cmd
cd cracha-virtual-frontend
npm run dev
```

### Verifica√ß√£o da Instala√ß√£o

Ap√≥s inicializar todos os servi√ßos, verifique se est√£o funcionando corretamente:

1. **Backend API**: http://localhost:3000/api
2. **Frontend**: http://localhost:5173
3. **Adminer (se habilitado)**: http://localhost:8080

### Credenciais de Teste

Se voc√™ executou o script de seed, use estas credenciais para testar:

- **Administrador**: admin@cracha.com / 123456
- **Usu√°rio comum**: user1@cracha.com / 123456

## üõ†Ô∏è Scripts de Automa√ß√£o para Windows

### Script de Inicializa√ß√£o Completa

Crie um arquivo `start-dev.bat` na raiz do projeto:

```batch
@echo off
echo ========================================
echo  Sistema de Crachas Virtuais - Dev
echo ========================================
echo.

echo Verificando Docker...
docker --version >nul 2>&1
if errorlevel 1 (
    echo ERRO: Docker nao encontrado. Instale o Docker Desktop.
    pause
    exit /b 1
)

echo Iniciando banco de dados PostgreSQL...
docker-compose -f docker-compose.dev.yml up -d postgres-dev

echo Aguardando banco de dados ficar pronto...
timeout /t 10 /nobreak >nul

echo Verificando conexao com banco...
docker exec cracha_postgres_dev pg_isready -U cracha_user -d cracha_virtual_dev
if errorlevel 1 (
    echo ERRO: Banco de dados nao esta respondendo.
    pause
    exit /b 1
)

echo.
echo ========================================
echo  Banco de dados iniciado com sucesso!
echo ========================================
echo.
echo Para iniciar o backend, execute:
echo   cd cracha-virtual-system
echo   npm run dev
echo.
echo Para iniciar o frontend, execute:
echo   cd cracha-virtual-frontend  
echo   npm run dev
echo.
echo URLs de acesso:
echo   Frontend: http://localhost:5173
echo   Backend:  http://localhost:3000/api
echo   Adminer:  http://localhost:8080
echo.
pause
```

### Script de Parada dos Servi√ßos

Crie um arquivo `stop-dev.bat`:

```batch
@echo off
echo Parando servicos do Sistema de Crachas Virtuais...

echo Parando containers Docker...
docker-compose -f docker-compose.dev.yml down

echo Servicos parados com sucesso!
pause
```

### Script de Reset do Banco

Crie um arquivo `reset-db.bat`:

```batch
@echo off
echo ========================================
echo  RESET DO BANCO DE DADOS
echo ========================================
echo.
echo ATENCAO: Esta operacao ira apagar todos os dados!
echo.
set /p confirm="Tem certeza? (S/N): "
if /i not "%confirm%"=="S" (
    echo Operacao cancelada.
    pause
    exit /b 0
)

echo Parando containers...
docker-compose -f docker-compose.dev.yml down

echo Removendo volume do banco...
docker volume rm cracha-virtual-system_postgres_dev_data

echo Reiniciando banco de dados...
docker-compose -f docker-compose.dev.yml up -d postgres-dev

echo Aguardando banco ficar pronto...
timeout /t 15 /nobreak >nul

echo Executando migracoes...
cd cracha-virtual-system
npx prisma migrate dev --name reset

echo Populando com dados de exemplo...
node scripts/seed.js

echo.
echo Banco de dados resetado com sucesso!
pause
```

## üîß Configura√ß√µes Avan√ßadas

### Configura√ß√£o do Visual Studio Code

Se voc√™ usa o VS Code, crie um arquivo `.vscode/settings.json` na raiz do projeto:

```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "files.associations": {
    "*.env": "dotenv"
  },
  "emmet.includeLanguages": {
    "javascript": "javascriptreact"
  }
}
```

### Extens√µes Recomendadas para VS Code

Crie um arquivo `.vscode/extensions.json`:

```json
{
  "recommendations": [
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "ms-vscode.vscode-typescript-next",
    "prisma.prisma",
    "ms-vscode.powershell"
  ]
}
```

### Configura√ß√£o de Debugging

Crie um arquivo `.vscode/launch.json` para debugging:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Backend",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/cracha-virtual-system/server.js",
      "env": {
        "NODE_ENV": "development"
      },
      "console": "integratedTerminal",
      "cwd": "${workspaceFolder}/cracha-virtual-system"
    }
  ]
}
```

## üêõ Solu√ß√£o de Problemas Comuns

### Problemas com Docker

**Erro: "Docker daemon is not running"**
- Solu√ß√£o: Inicie o Docker Desktop e aguarde a inicializa√ß√£o completa

**Erro: "Port 5432 is already in use"**
- Solu√ß√£o: Pare outros servi√ßos PostgreSQL ou altere a porta no docker-compose.dev.yml

**Erro: "No space left on device"**
- Solu√ß√£o: Execute `docker system prune` para limpar containers e imagens n√£o utilizados

### Problemas com Node.js

**Erro: "npm ERR! peer dep missing"**
- Solu√ß√£o: Execute `npm install --legacy-peer-deps`

**Erro: "Cannot find module"**
- Solu√ß√£o: Delete `node_modules` e execute `npm install` novamente

**Erro: "Port 3000 is already in use"**
- Solu√ß√£o: Altere a porta no arquivo `.env` ou pare o processo que est√° usando a porta

### Problemas com Prisma

**Erro: "Environment variable not found: DATABASE_URL"**
- Solu√ß√£o: Verifique se o arquivo `.env` existe e cont√©m a vari√°vel DATABASE_URL

**Erro: "Can't reach database server"**
- Solu√ß√£o: Verifique se o container PostgreSQL est√° rodando com `docker ps`

**Erro: "Migration failed"**
- Solu√ß√£o: Execute `npx prisma migrate reset` para resetar as migra√ß√µes

### Problemas de Performance

**Aplica√ß√£o lenta no Windows**
- Solu√ß√£o: Adicione as pastas do projeto ao Windows Defender Exclusions
- Caminho: Windows Security > Virus & threat protection > Exclusions

**Build lento do frontend**
- Solu√ß√£o: Adicione `node_modules` √†s exclus√µes do antiv√≠rus

## üìö Comandos √öteis

### Comandos Docker
```cmd
# Verificar containers rodando
docker ps

# Ver logs do banco
docker logs cracha_postgres_dev

# Acessar shell do banco
docker exec -it cracha_postgres_dev psql -U cracha_user -d cracha_virtual_dev

# Parar todos os containers
docker-compose -f docker-compose.dev.yml down

# Remover volumes (apaga dados)
docker-compose -f docker-compose.dev.yml down -v
```

### Comandos Prisma
```cmd
# Gerar cliente
npx prisma generate

# Executar migra√ß√µes
npx prisma migrate dev

# Resetar banco
npx prisma migrate reset

# Visualizar banco (Prisma Studio)
npx prisma studio

# Verificar status das migra√ß√µes
npx prisma migrate status
```

### Comandos npm
```cmd
# Instalar depend√™ncias
npm install

# Executar em modo desenvolvimento
npm run dev

# Fazer build para produ√ß√£o
npm run build

# Verificar depend√™ncias desatualizadas
npm outdated

# Atualizar depend√™ncias
npm update
```

## üîÑ Workflow de Desenvolvimento

### Rotina Di√°ria de Desenvolvimento

1. **Iniciar o dia**:
   ```cmd
   # Execute o script de inicializa√ß√£o
   start-dev.bat
   ```

2. **Desenvolver**:
   - Abra dois terminais adicionais
   - Terminal 1: `cd cracha-virtual-system && npm run dev`
   - Terminal 2: `cd cracha-virtual-frontend && npm run dev`

3. **Finalizar o dia**:
   ```cmd
   # Execute o script de parada
   stop-dev.bat
   ```

### Backup e Restore de Dados

**Fazer backup**:
```cmd
docker exec cracha_postgres_dev pg_dump -U cracha_user cracha_virtual_dev > backup.sql
```

**Restaurar backup**:
```cmd
docker exec -i cracha_postgres_dev psql -U cracha_user cracha_virtual_dev < backup.sql
```

### Atualiza√ß√µes do Projeto

Quando receber atualiza√ß√µes do projeto:

1. **Parar servi√ßos**:
   ```cmd
   stop-dev.bat
   ```

2. **Atualizar depend√™ncias**:
   ```cmd
   cd cracha-virtual-system
   npm install
   
   cd ../cracha-virtual-frontend
   npm install
   ```

3. **Executar migra√ß√µes**:
   ```cmd
   cd cracha-virtual-system
   npx prisma migrate dev
   ```

4. **Reiniciar servi√ßos**:
   ```cmd
   start-dev.bat
   ```

Este guia fornece uma base s√≥lida para desenvolvimento local no Windows, aproveitando a containeriza√ß√£o do PostgreSQL para simplificar a configura√ß√£o e manuten√ß√£o do ambiente de desenvolvimento.

